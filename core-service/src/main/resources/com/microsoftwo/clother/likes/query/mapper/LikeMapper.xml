<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.microsoftwo.clother.likes.query.mapper.LikeMapper">

    <resultMap id="findLikedItemsByUserIdResultMap" type="com.microsoftwo.clother.likes.query.dto.LikeDTO">
        <id property="id" column="id"/>
        <result property="type" column="type"/>
        <result property="content" column="content"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <select id="findLikedItemsByUserId" resultType="com.microsoftwo.clother.likes.query.dto.LikeDTO">
        SELECT l.id, 'post' AS type, p.content, p.created_at
        FROM likes l
                 JOIN post p ON l.post_id = p.id
        WHERE l.user_id = #{userId}

        UNION ALL

        SELECT l.id, 'comment' AS type, c.content, c.created_at
        FROM likes l
                 JOIN comment c ON l.comment_id = c.id
        WHERE l.user_id = #{userId}

        UNION ALL

        SELECT l.id, 'board' AS type, b.title, b.created_at
        FROM likes l
                 JOIN advice_board b ON l.board_id = b.id
        WHERE l.user_id = #{userId}
    </select>
</mapper>